{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Planned vs Unplanned â€” Pie (slider: year)",
  "width": 380,
  "height": 380,

  "data": {
    "url": "https://raw.githubusercontent.com/ibrahimahsen/FIT3179_DataVisualization2/refs/heads/main/data/state_burn_flags_by_state_2016_2021.csv"
  },

  "params": [
    {
      "name": "yrNum",
      "value": 2017,
      "bind": {"input": "range", "min": 2017, "max": 2022, "step": 1, "name": "End year (2022 = All): "}
    }
  ],

  "transform": [
  {
    "fold": [
      "U_1617","U_1718","U_1819","U_1920","U_2021",
      "P_1617","P_1718","P_1819","P_1920","P_2021"
    ],
    "as": ["key","count"]
  },
  { "calculate": "slice(datum.key, 0, 2) == 'U_' ? 'Unplanned' : 'Planned'", "as": "type" },
  { "calculate": "2000 + toNumber(slice(datum.key, 4, 6))", "as": "yearNumFromKey" },

  { "filter": "yrNum == 2022 || datum.yearNumFromKey == yrNum" },

  { "aggregate": [{"op": "sum", "field": "count", "as": "total"}], "groupby": ["type"] },

  { "joinaggregate": [{"op": "sum", "field": "total", "as": "grandTotal"}] },

  { "calculate": "datum.total / datum.grandTotal", "as": "pct" },

  { "calculate": "yrNum == 2022 ? 'All years' : 'Year: ' + toString(yrNum)", "as": "labelText" }
  ],

  "layer": [
    {
      "mark": {"type": "arc", "outerRadius": 180, "innerRadius": 60},
      "encoding": {
        "theta": {"field": "total", "type": "quantitative"},
        "color": {
          "field": "type",
          "type": "nominal",
          "scale": {"range": ["#1f77b4", "#e6550d"]},
          "legend": {"title": null, "labelFontSize": 14}
        },
        "tooltip": [
          {"field": "type", "title": "Category"},
          {"field": "total", "type": "quantitative", "title": "Count"},
          {"field": "pct", "type": "quantitative", "title": "Share", "format": ".0%"}
        ]
      }
    },

    {
      "mark": {"type": "text", "fontSize": 14, "fontWeight": "bold"},
      "encoding": {
        "text": { "field": "labelText"}
      }
    }
  ]
}
